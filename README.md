# Django-S3-base
## –®–∞–±–ª–æ–Ω Django + S3 Timeweb Cloud

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –†–∞–∑–¥–µ–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

–≠—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —à–∞–±–ª–æ–Ω –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Django, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–∫–ª—é—á–∞–µ—Ç S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∫ –≤–∞—à–µ–º—É –ø—Ä–æ–µ–∫—Ç—É.

### –¶–µ–ª—å –¥–∞–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
–ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ S3 —è —Å—Ç–æ–ª–∫–Ω—É–ª—Å—è —Å –ø—Ä–æ–±–ª–µ–º–æ–π ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ S3 —Å Django –≤ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö. –ü–æ—ç—Ç–æ–º—É —è –ø—É–±–ª–∏–∫—É—é —ç—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –∫–∞–∫ —à–∞–±–ª–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ S3 –∫ –∞–¥–º–∏–Ω–∫–µ Django –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã.

–í –∫–∞—á–µ—Å—Ç–≤–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ S3 —è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –æ—Ç Timeweb Cloud. –•–æ—Ç—è –æ–Ω–æ –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–¥–µ–Ω—Ç–∏—á–Ω–æ AWS, –∞ —Ç–∫–∞–∂–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º, –µ–≥–æ –≤—Å—ë–∂–µ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. –ï—Å–ª–∏ –≤–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –≤—ã –º–æ–∂–µ—Ç–µ, —Å–ª–µ–¥—É—è –ø—Ä–∏–Ω—Ü–∏–ø–∞–º —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥—Ä—É–≥–æ–µ S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.

---

### –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞:

```bash
git clone https://github.com/RomanAlexLab/Django-S3-base.git
```

---

### –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
python -m venv venv
```

–ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

- **Linux:**
  ```bash
  source venv/bin/activate
  ```
- **Windows:**
  ```bash
  venv\Scripts\activate
  ```

---

### Pyenv
–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Pyenv —Å Python 3.13.3. –ï—Å–ª–∏ –≤—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Pyenv, –≤–æ–∑–º–æ–∂–Ω–æ, –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª `.python-version`.  
–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Pyenv, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python 3.13.3:

- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Pyenv –¥–ª—è Windows: [https://pypi.org/project/pyenv-win/](https://pypi.org/project/pyenv-win/)  
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —Ä–∞–±–æ—Ç–∞ —Å Pyenv –¥–ª—è Ubuntu: [https://itshaman.ru/news/linux/ustanovka-neskolkikh-versii-python-na-ubuntu-s-pomoshchyu-pyenv](https://itshaman.ru/news/linux/ustanovka-neskolkikh-versii-python-na-ubuntu-s-pomoshchyu-pyenv)

---

### pip-tools
–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `pip-tools`. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –≤–∞—à–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏, –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ:

```bash
pip install pip-tools
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ï—Å–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–∏—Ç—å PIP, —Å–¥–µ–ª–∞–π—Ç–µ —ç—Ç–æ –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

---

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–∫–∞–∑–∞–Ω—ã –≤ —Ñ–∞–π–ª–∞—Ö `requirements.in` (–¥–ª—è `pip-tools`) –∏ `requirements.txt`:

- Django==5.2.3
- dotenv==0.9.9
- pillow==11.2.1
- boto3==1.38.46
- django-storages[s3]==1.14.6
- django-csp==4.0

–ö–æ–º–∞–Ω–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏—Å–º–æ—Å—Ç–µ–π:
```bash
pip-sync
```

---

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
–í —Ñ–∞–π–ª–µ `.env` —É–∫–∞–∂–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á Django –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ S3 –æ—Ç Timeweb Cloud.

–í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å —Ñ–∞–π–ª–æ–º `settings.py` –¥–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã:  
- `const_conf.py` ‚Äî –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã  
- `cors_conf.py` ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CORS –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  
- `log_conf.py` ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è  
- `s3_conf.py` ‚Äî –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (–æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª)  

---

### settings.py
–í—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã.

–ü–æ–¥–≥—Ä—É–∑–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```python
load_dotenv()
```

```python
# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = os.getenv("DJANGO_SECRET_KEY")
```

#### –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```python
MODE_DEV = False
```

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```python
# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True if MODE_DEV else False

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ logfile + –ø—É—Ç—å –¥–æ logfile
LOG_FILE = PATH_LOG_FILE
os.makedirs(os.path.dirname(LOG_FILE), exist_ok=True)

# –£–∫–∞–∑—ã–≤–∞–µ–º, –∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–∞—à —Å–ª–æ–≤–∞—Ä—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
LOGGING_CONFIG = 'logging.config.dictConfig'

# –î–µ–ª–∞–µ–º –≥–ª—É–±–æ–∫—É—é –∫–æ–ø–∏—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
LOGGING = copy.deepcopy(LOG_CONF)

# –ó–∞–¥–∞—ë–º —Ä–µ–∞–ª—å–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –ª–æ–≥–æ–≤
LOGGING['handlers']['file']['filename'] = LOG_FILE

# –ï—Å–ª–∏ DEBUG –≤—ã–∫–ª—é—á–µ–Ω ‚Äî –º–µ–Ω—è–µ–º —É—Ä–æ–≤–µ–Ω—å –≤—Å–µ—Ö –ª–æ–≥–≥–µ—Ä–æ–≤ –Ω–∞ ERROR
if not DEBUG:
    for logger in LOGGING['loggers'].values():
        logger['level'] = 'ERROR'
```

#### –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ Hosts
```python
ALLOWED_HOSTS = G_ALLOWED_HOSTS_LIST
```

#### Content-Security-Policy (CSP)
```python
MAIN_DOMAIN = CORS_MAIN_DOMAIN
CSP_DEFAULT_SRC = CORS_CSP_DEFAULT_SRC
CSP_INCLUDE_NONCE_IN = CORS_CSP_INCLUDE_NONCE_IN
CSP_SCRIPT_SRC = CORS_CSP_SCRIPT_SRC
CSP_STYLE_SRC = CORS_CSP_STYLE_SRC
CSP_IMG_SRC = CORS_CSP_IMG_SRC
CSP_FONT_SRC = CORS_CSP_FONT_SRC
CSP_CONNECT_SRC = CORS_CSP_CONNECT_SRC
CSP_OBJECT_SRC = CORS_CSP_OBJECT_SRC
CSP_MEDIA_SRC = CORS_CSP_MEDIA_SRC
CSP_FRAME_SRC = CORS_CSP_FRAME_SRC
CSP_BASE_URI = CORS_CSP_BASE_URI
CSP_FORM_ACTION = CORS_CSP_FORM_ACTION
CSP_MANIFEST_SRC = CORS_CSP_MANIFEST_SRC
```

#### Application
```python
INSTALLED_APPS = [
    ...
    'storages',
    'app_storage',
]
```

#### Middleware
```python
MIDDLEWARE = [
    ...
    'csp.middleware.CSPMiddleware',
]
```

#### –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ URL-–∞–¥—Ä–µ—Å–æ–≤ (URLconf)
```python
ROOT_URLCONF = 'app_config.urls'
```

#### –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ HTML-—à–∞–±–ª–æ–Ω–æ–≤
```python
TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [BASE_DIR / 'templates'],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]
```

#### Internationalization
```python
# https://docs.djangoproject.com/en/5.2/topics/i18n/
LANGUAGE_CODE = 'ru-ru'
TIME_ZONE = 'UTC'
USE_I18N = True
USE_TZ = True
```

#### –•—Ä–∞–Ω–∏–ª–∏—â–µ –∏ —Ñ–∞–π–ª—ã

##### Static files (CSS, JavaScript, Images)
```python
# https://docs.djangoproject.com/en/5.2/howto/static-files/

# –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ —Å—Ç–∞—Ç–∏–∫–æ–π (–≥–¥–µ Django –∏—â–µ—Ç —Å—Ç–∞—Ç–∏–∫—É –ø—Ä–∏ —Å–±–æ—Ä–∫–µ)
STATICFILES_DIRS = [
    os.path.join(BASE_DIR, "static"),
]

if MODE_DEV:
    STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')
    STATIC_URL = '/static/'
    MEDIA_ROOT = os.path.join(BASE_DIR, 'media')
    MEDIA_URL = '/media/'
else:
    # –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –∫—É–¥–∞ —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è —Å–æ–±—Ä–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏–∫–∞ –∏–ª–∏
    # –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ–∞–π–ª—ã (–ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å S3 –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
    # DEFAULT_FILE_STORAGE = 'django.core.files.storage.FileSystemStorage'
    # STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')
    # MEDIA_ROOT = os.path.join(BASE_DIR, 'media')

    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è S3
    STORAGES = STORAGES_CONF

    # –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å —Ñ–∞–π–ª–∞–º–∏ (–æ—Ç–∫—É–¥–∞ Django –±–µ—Ä—ë—Ç –ø—É—Ç–∏ –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å—Å—ã–ª–æ–∫ –Ω–∞ —Ñ–∞–π–ª—ã)
    # –ï—Å–ª–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å S3 –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–≤–æ–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤,
    # —Ç–æ MEDIA_URL –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–æ –æ—Å—Ç–∞–≤–ª–µ–Ω –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
    STATIC_URL = f"https://{S3Data.AWS_S3_CUSTOM_DOMAIN}/static/"
    MEDIA_URL = f"https://{S3Data.AWS_S3_CUSTOM_DOMAIN}/media/"
```

---

### –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞
```bash
python manage.py makemigrations
python manage.py migrate
python manage.py createsuperuser
python manage.py collectstatic
python manage.py runserver
```

---

## üìß –ö–∞–∫ —Å–≤—è–∑–∞—Ç—å—Å—è —Å–æ –º–Ω–æ–π

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ–±—Å—É–¥–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ, –≤—ã –º–æ–∂–µ—Ç–µ —Å–≤—è–∑–∞—Ç—å—Å—è —Å–æ –º–Ω–æ–π —á–µ—Ä–µ–∑:


-  **Vk:** [–ü—Ä–æ—Ñ–∏–ª—å Vk](https://vk.com/roman2019alex)

-  **Telegram:** [@Roman89n](https://t.me/Roman89n)